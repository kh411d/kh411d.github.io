<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:image" content="http://khal.web.id/images/arch-screenfetch.png"/>
    



<meta name="twitter:title" content="Rusty Macbook Air getting new Air from Archlinux"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@khalidity"/>



  	<meta property="og:title" content="Rusty Macbook Air getting new Air from Archlinux &middot; Khalid&#39;s Blog" />
  	<meta property="og:site_name" content="Khalid&#39;s Blog" />
  	<meta property="og:url" content="http://khal.web.id/2018/01/25/Rusty-Macbook-Air-getting-new-Air-from-Archlinux/" />

    
       <meta property="og:image" content="http://khal.web.id/images/arch-screenfetch.png"/>
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2018-01-25T00:40:18&#43;07:00" />

    
    <meta property="article:tag" content="macbook-air" />
    
    <meta property="article:tag" content="archlinux" />
    
    <meta property="article:tag" content="linux" />
    
    <meta property="article:tag" content="operating-system" />
    
    <meta property="article:tag" content="osx" />
    
    

    <title>Rusty Macbook Air getting new Air from Archlinux &middot; Khalid&#39;s Blog</title>

    
    <meta name="description" content="Today I accidentally deleted my primary osx partition from my very old macbook air 4,2 (2011) with last installed os was el capitan. From the beginning I just w" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    

    
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Khalid&#39;s Blog" />
      
      
    
    <meta name="generator" content="Hugo 0.46" />

    <link rel="canonical" href="http://khal.web.id/2018/01/25/Rusty-Macbook-Air-getting-new-Air-from-Archlinux/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": Khalid Adisendjaja,
        "logo": http://khal.web.id/images/logo.jpeg
    },
    "author": {
        "@type": "Person",
        "name": Khalid Adisendjaja,
        
        "image": {
            "@type": "ImageObject",
            "url": http://khal.web.id/images/logo.jpeg,
            "width": 250,
            "height": 250
        }, 
        
        "url": http://khal.web.id,
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": Internet tech wanderer. Networking enthusiast. Radio Announcer. Casual Gamer. OpenSource Fans. Information Junkies. My tweet is my own.
        
    },
    "headline": Rusty Macbook Air getting new Air from Archlinux,
    "name": Rusty Macbook Air getting new Air from Archlinux,
    "wordCount": 1240,
    "timeRequired": "PT6M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": http://khal.web.id/2018/01/25/Rusty-Macbook-Air-getting-new-Air-from-Archlinux/,
    "datePublished": 2018-01-25T00:40Z,
    "dateModified": 2018-01-25T00:40Z,
    
    "image": {
        "@type": "ImageObject",
        "url": http://khal.web.id//images/arch-screenfetch.png,
        "width": 3000,
        "height": 1445
    },
    
    "keywords": macbook-air, archlinux, linux, operating-system, osx,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": http://khal.web.id/2018/01/25/Rusty-Macbook-Air-getting-new-Air-from-Archlinux/
    }
}
    </script>
    


    

    

    
    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P4GNFJ5');</script>

</head>
<body class="nav-closed">

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P4GNFJ5"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



  
  <header class="main-header post-head" style="background-image: url(/images/arch-screenfetch.png)">
  
  <nav class="main-nav overlay clearfix">


  
      <a class="blog-logo" href="http://khal.web.id/"><img src="/images/logo.jpeg" alt="Home" /></a>
  
  
      <a class="menu-button icon-feed" href="/index.xml" >&nbsp;&nbsp;Subscribe</a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Rusty Macbook Air getting new Air from Archlinux</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2018-01-25T00:40:18&#43;07:00">
            Jan 25, 2018
          </time>
        
         
          <span class="post-tag small"><a href="http://khal.web.id//tags/macbook-air/">#macbook-air</a></span>
         
          <span class="post-tag small"><a href="http://khal.web.id//tags/archlinux/">#archlinux</a></span>
         
          <span class="post-tag small"><a href="http://khal.web.id//tags/linux/">#linux</a></span>
         
          <span class="post-tag small"><a href="http://khal.web.id//tags/operating-system/">#operating-system</a></span>
         
          <span class="post-tag small"><a href="http://khal.web.id//tags/osx/">#osx</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p>Today I accidentally deleted my primary osx partition from my very old macbook air 4,2 (2011) with last installed os was el capitan. From the beginning I just want to give my macbook some extra space but it turns out cleaning all the HDD &hellip;LOL, I seriously don&rsquo;t know how in the hell this could happened, this is a lesson for not to clean your HDD in the middle of the night.</p>

<p>And then I follow up the step from apple website on how to reinstall osx, turns out that I have to download 10Gb update including el capitan.</p>

<h1 id="whaaa-whaa-whaaaaattttt">Whaaa whaa whaaaaattttt!!!</h1>

<p>Without a doubt I immediately cancel the download, had crossed my mind to get a linux os. So many distro can be installed, googled around and I found that Archlinux is a better option because of its crowded community, simplicity and support for many file systems. And also I like how archlinux define simplicity,</p>

<blockquote>
<p>without unnecessary additions or modifications</p>
</blockquote>

<p>much more customable by your needs, imagine it as a one big playground of LEGO blocks for operating system. You only need a 500Mb Archlinux Iso to get this done, Compare with 10Gb download and an endless waiting.</p>

<p>I&rsquo;d like to share my experience starting from installing Archlinux and get started with Archlinux, me myself is not a linux power user, I do a lot of googling to get through the installaion, so here I&rsquo;ll explain all of my finding.</p>

<h4 id="get-the-iso-forget-the-archboot">Get the ISO forget the Archboot</h4>

<p>I&rsquo;d like to have something such as ubuntu light GUI that will guide you through the installation step, so then I found Archboot, been trying to install Archlinux from Archboot usb bootdisk several times with no luck so its just wasting my time, it seems this archboot iso is outdated, I gave up.
It would be better if you could just use the iso that you can download here <a href="https://www.archlinux.org/download/">https://www.archlinux.org/download/</a></p>

<h4 id="boot-to-arch-iso">Boot to Arch ISO</h4>

<ol>
<li><a href="https://www.archlinux.org/download/">Download the iso</a> flash it to your usb disk with dd command or any software, check this great post of <a href="https://www.raspberrypi.org/documentation/installation/installing-images/mac.md">raspberrypi installation</a> for reference.</li>
<li>You may need a usb-ethernet dongle to connect with the internet, or some people using their cellphone internet tether through usb cable.</li>
</ol>

<p>Plug in your USB bootdisk and hold ‘alt/option’ button while your system boots up, choose the USB to boot from.</p>

<h4 id="partition">Partition</h4>

<p>After boot system is up, check your available drive,</p>

<pre><code>$ lsblk
</code></pre>

<p>Delete all partitions on your ssd, and then create 4 partitions, these are partitions from my current installation,</p>

<pre><code>$ lsblk
NAME MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda    8:0    0  113G  0 disk 
├─sda1
│      8:1    0    1G  0 part /boot
├─sda2
│      8:2    0  512M  0 part [SWAP]
├─sda3
│      8:3    0   32G  0 part /
└─sda4
       8:4    0 79.5G  0 part /home
</code></pre>

<p>As you can see my boot partition is 1G, this was actually unintended, everything could go wrong if you did this in the middle of the night. 256Mb should be enough for /boot partition.</p>

<pre><code>Disk: /dev/sda
              Size: 113 GiB, 121332826112 bytes, 236978176 sectors
          Label: gpt, identifier: F17EF130-xxxx-xxxx-xxxx-xxxxxxxxxxxx

    Device            Start         End     Sectors    Size Type
    /dev/sda1          2048     2099199     2097152      1G EFI System          
    /dev/sda2       2099200     3147775     1048576    512M Linux swap
    /dev/sda3       3147776    70256639    67108864     32G Linux root (x86-64)
    /dev/sda4      70256640   236978142   166721503   79.5G Linux home

</code></pre>

<p>I&rsquo;m always keep this url open while partitioning <a href="https://www.rodsbooks.com/gdisk/cgdisk-walkthrough.html">cgdisk-walkthrough</a></p>

<pre><code># cgdisk /dev/sda
</code></pre>

<p>After you&rsquo;re done, format and mount your newly created partition, File system root <strong>/</strong> inside the terminal belongs to USB stick, while everything mounted inside <strong>/mnt</strong> is the target media AKA your SSD.</p>

<pre><code># mkfs.vfat -F32 /dev/sda1
# mkswap /dev/sda2
# mkfs.ext4 /dev/sda3
# mkfs.ext4 /dev/sda4
# mkdir /mnt/boot &amp;&amp; mount /dev/sda1 /mnt/boot
# mkdir /mnt/home &amp;&amp; mount /dev/sda4 /mnt/home
# mount /dev/sda3 /mnt
# swapon /dev/sda2
</code></pre>

<h4 id="installation">Installation</h4>

<pre><code># pacstrap /mnt base base-devel
# genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>

<p>Modify fstab configuration for SSD drive type, this is important, do not skip.</p>

<pre><code># nano /mnt/etc/fstab
</code></pre>

<p>add additional parameters,</p>

<pre><code>rw,relatime,data=ordered,discard
</code></pre>

<p>Mine will look like this,</p>

<pre><code># /dev/sda3
UUID=b532cc5e-70c4-431c-80e5-bd9d40440606   /           ext4        rw,relatime,data=ordered,discard    0 1

# /dev/sda4
UUID=d5a039d9-c08e-4b26-8e12-9e38bec1fd46   /home       ext4        rw,relatime,data=ordered,discard    0 2
</code></pre>

<h4 id="connect-the-internet">Connect the internet</h4>

<p>If you&rsquo;re using ethernet cable or usb cable, you may check your network interface with this,</p>

<pre><code># ip link
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: wlp2s0b1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DORMANT group default qlen 1000
    link/ether 10:40:f3:8c:30:f4 brd ff:ff:ff:ff:ff:ff
</code></pre>

<p>My interface is <strong>wlp2s0b1</strong></p>

<pre><code># dhcpcd wlp2s0b1
# ping google.com
</code></pre>

<p>If you can use WiFi, connect it with this command,</p>

<pre><code># wifi-menu
</code></pre>

<h4 id="system-configuration">System Configuration</h4>

<pre><code># arch-chroot /mnt /bin/bash 
# echo archer &gt; /etc/hostname  #Your hostname
# ln -s /usr/share/zoneinfo/Asia/Jakarta /etc/localtime 
# hwclock --systohc --utc 
</code></pre>

<pre><code># nano /etc/local.gen
</code></pre>

<p>Uncomment UTF8 locale,</p>

<pre><code>#en_SG ISO-8859-1
en_US.UTF-8 UTF-8
#en_US ISO-8859-1
</code></pre>

<pre><code># locale-gen
# echo LANG=en_US.UTF-8 &gt; /etc/locale.conf
</code></pre>

<p>Add user account,</p>

<pre><code># useradd -m -g users -G wheel -s /bin/bash yourself &amp;&amp; passwd yourself
</code></pre>

<p>Change <strong>yourself</strong> to your liking.</p>

<p>Give yourself sudo rights,</p>

<pre><code># nano /etc/sudoers # uncomment wheel line
</code></pre>

<pre><code> %wheel ALL=(ALL) NOPASSWD: ALL
</code></pre>

<h3 id="the-bootloader">The Bootloader</h3>

<p>I&rsquo;m not goin to dualboot this macbook so then I&rsquo;m not gonna use GRUB nor REFIND for booting into the system, I&rsquo;m gonna use <a href="https://wiki.archlinux.org/index.php/systemd-boot"><strong>systemd-boot</strong></a> to boot into archlinux,</p>

<pre><code># pacman -S dosfstools intel-ucode
# bootctl --path=/boot install
</code></pre>

<p>After the systemd-boot (gummiboot) installed, we need to add a boot entries for archlinux.</p>

<p>Create a file for boot entry within this directory path,</p>

<pre><code>/boot/loader/entries/arch.conf
</code></pre>

<p>First you need to get your root &ldquo;/&rdquo; (/dev/sda3) PARTUUID,</p>

<pre><code># blkid -s PARTUUID -o value /dev/sda3
ed724519-29ca-4e08-b27a-b4852d310dee
</code></pre>

<p>Edit the arch.conf file add this entry, replace root PARTUUID with this one <em>ed724519-29ca-4e08-b27a-b4852d310dee</em></p>

<pre><code>title Arch Linux 
linux /vmlinuz-linux 
initrd /intel-ucode.img 
initrd /initramfs-linux.img 
options root=PARTUUID=ed724519-29ca-4e08-b27a-b4852d310dee rw quiet
</code></pre>

<p>And now lets tell the boot manager to use this arch.conf configuration,</p>

<pre><code># echo &quot;default arch&quot; &gt; /boot/loader/loader.conf
</code></pre>

<p>Before rebooting, you may want to install some network tools,</p>

<pre><code># pacman install iw wireless_tools wpa_supplicant dialog
</code></pre>

<p>also install networkmanager and enable it using NetworkManager.service. <a href="https://wiki.archlinux.org/index.php/NetworkManager">Read Arch wiki for more info</a>.</p>

<p>You&rsquo;re done now for installation, lets reboot,</p>

<pre><code># exit
# umount -R /mnt
# sudo reboot // or systemctl reboot
</code></pre>

<h1 id="post-installation">Post Installation</h1>

<h3 id="configure-your-wifi">Configure your wifi</h3>

<p>You can use wifi-menu, netctl, dhcpd or anything to connect, here we try to use network manager,</p>

<pre><code>$ sudo systemctl disable dhcpcd
$ sudo pacman -S networkmanager network-manager-applet
$ sudo systemctl enable NetworkManager
$ nmcli dev wifi connect &lt;wifi-name&gt; password &lt;password&gt;
</code></pre>

<h3 id="install-cpu-tools">Install CPU tools</h3>

<pre><code>$ sudo pacman -S cpupower
$ sudo systemctl enable cpupower
</code></pre>

<p>Edit /etc/default/cpupower</p>

<pre><code># Define CPUs governor
governor='powersave'
</code></pre>

<h3 id="sound-utilities">Sound Utilities</h3>

<pre><code>$ sudo pacman -S alsa-utils alsa-plugins
</code></pre>

<h3 id="install-xorg">Install Xorg</h3>

<pre><code>$ sudo pacman -S xorg acpid
$ systemctl enable acpid
</code></pre>

<h3 id="install-desktop-gui">Install Desktop GUI</h3>

<p>There is so many <a href="https://wiki.archlinux.org/index.php/desktop_environment#List_of_desktop_environments">desktop GUI</a> that you may want to experience yourself, but <a href="https://wiki.archlinux.org/index.php/xfce#Installation">XFCE4</a> is become my first choice because of speed and flexibility.</p>

<pre><code>$ sudo pacman -S xfce4 xfce4-goodies
</code></pre>

<h3 id="install-display-manager-user-login">Install Display Manager (User Login)</h3>

<p>Same as desktop GUI, there is so many <a href="https://wiki.archlinux.org/index.php/Display_manager">display manager</a> to experience yourself, as my choice fell to <a href="https://wiki.archlinux.org/index.php/LightDM">LightDM</a></p>

<pre><code>$ sudo pacman -S lightdm lightdm-gtk-greeter-setting
$ systemctl enable lightdm.service
</code></pre>

<p>Now you&rsquo;re all set, reboot and enjoy your new Macbook Arch.
Things you may need to know, ArchLinux has a <a href="https://aur.archlinux.org/">community driven repository</a> that you can download and build yourself or using some package manager such as <strong>yaourt</strong>, <strong>pacaur</strong>, or <strong>trizen</strong> for easy install. I&rsquo;m not goin to explain all of these things it depends to your liking. I&rsquo;ll leave this to you to explore and have fun with it.</p>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="http://khal.web.id/" style="background-image: url(/images/logo.jpeg)"><span class="hidden">Khalid Adisendjaja's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="http://khal.web.id/">Khalid Adisendjaja</a></h4>
  
  <p>Internet tech wanderer. Networking enthusiast. Radio Announcer. Casual Gamer. OpenSource Fans. Information Junkies. My tweet is my own.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Jakarta, Indonesia</span>
    <span class="author-link icon-link"><a href="http://khal.web.id">http://khal.web.id</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Rusty%20Macbook%20Air%20getting%20new%20Air%20from%20Archlinux&nbsp;-&nbsp;Khalid%27s%20Blog&amp;url=http%3a%2f%2fkhal.web.id%2f2018%2f01%2f25%2fRusty-Macbook-Air-getting-new-Air-from-Archlinux%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fkhal.web.id%2f2018%2f01%2f25%2fRusty-Macbook-Air-getting-new-Air-from-Archlinux%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fkhal.web.id%2f2018%2f01%2f25%2fRusty-Macbook-Air-getting-new-Air-from-Archlinux%2f&amp;description=Rusty%20Macbook%20Air%20getting%20new%20Air%20from%20Archlinux"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fkhal.web.id%2f2018%2f01%2f25%2fRusty-Macbook-Air-getting-new-Air-from-Archlinux%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "http:\/\/khal.web.id\/2018\/01\/25\/Rusty-Macbook-Air-getting-new-Air-from-Archlinux\/";  
this.page.identifier = "http:\/\/khal.web.id\/2018\/01\/25\/Rusty-Macbook-Air-getting-new-Air-from-Archlinux\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://khal-web-id.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="background-image: url(/images/portainer_header.jpg)" href="/2018/02/18/Meet-Docker-managers-for-human/">
          <section class="post">
              <h2>Meet Docker managers for human</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="background-image: url(/images/hugo-head.jpg)" href="/2018/01/02/Thanks-Jekyll.-Hello-Hugo/">
          <section class="post">
              <h2>Thanks Jekyll. Hello Hugo</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Khalid&#39;s Blog</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

